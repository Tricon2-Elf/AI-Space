<?xml version="1.0" ?>
<!DOCTYPE html 
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>footer.rd</title>
<link href="stylesheet.css" type="text/css" rel="stylesheet" />
</head>
<body>
<h1><a name="label-0" id="label-0">lobby-suite 暫定ドキュメント</a></h1><!-- RDLabel: "lobby-suite 暫定ドキュメント" -->
<p>lobby-suiteはmm-suiteを元に製作されています。</p>
<p>従ってこのドキュメントを読む前に，
<a href="http://www.vce-lab.net/mmsuite/doc/index-ja.html">mm-suiteのドキュメント</a>
を先だってお読み下さい。</p>
<h2><a name="label-1" id="label-1">サーバー構成</a></h2><!-- RDLabel: "サーバー構成" -->
<p>サーバー構成はmm-suiteと全く同じで，</p>
<ul>
<li>ロビーサーバー(LBSV)</li>
<li>スィッチングサーバー(SWP)</li>
<li>データベースサーバー(DBSV)</li>
<li>ロックサーバー(LOCKSV)</li>
<li>メッセージサーバー (MSGSV)</li>
<li>認証サーバー(AUTHSV)</li>
</ul>
<p>で構成されています。mm-suiteとの違いはゲームサーバーがロビーサーバーという
名称であるくらいです。</p>
<h2><a name="label-2" id="label-2">ロビーの空間管理</a></h2><!-- RDLabel: "ロビーの空間管理" -->
<p>ロビーはチャンネルと呼ばれる空間によって管理されています。
ユーザーはチャンネルに入室すると他ユーザーとのチャットや
ゲームの仲間募集やゲームのマッチングなどを行う事が出来るようになります。</p>
<h3><a name="label-3" id="label-3">チャンネルの名前の定義</a></h3><!-- RDLabel: "チャンネルの名前の定義" -->
<p>チャンネルには名前が定義されます。一つは人間に分かりやすい文字列，
もう一つはインターネットURLに似た文字列です。
前者はホームページのタイトルのようなもの，
後者はlobby-suite サーバー群にある，一つのチャンネルを指す為のものです。</p>
<p>書式は</p>
<p>ホスト部/ディレクトリ部/チャンネル</p>
<p>といった形式になります。
この文字列はホスト部とディレクトリ部に別れます。最初の"/"(スラッシュ)までがホスト部，
残りがディレクトリ部 + (チャンネル)です。
ホスト部のhostnameは，ロビー空間での仮想ホストの名前です。
これらはdata/hosts.txtで設定します。
ホストを分ける事により負荷分散します。
クライアントはURLを指定してopenプロトコルをサーバーに送信すると，
サーバーはホスト部とディレクトリ部にパースし，
接続しているホストが違えば目的のサーバーにスイッチングします。
ディレクトリ部は，ディレクトリ+(チャンネル)から構成されます。
ディレクトリ部は，インターネットURLと同じで，
チャンネル部が無ければディレクトリという扱いになります。
文字列の最後がスラッシュなら確実にディレクトリですが，無い場合は
チャンネルかディレクトリかの区別は付きません。
この場合，実際にオープンする時にサーバーが判断します。</p>
<p>そして，ディレクトリ部がディレクトリであればそのディレクトリに存在する
ディレクトリとチャンネルの一覧を返し，チャンネルであればそれを
オープンしチャンネルに入ります。</p>
<h3><a name="label-4" id="label-4">チャンネルの設定</a></h3><!-- RDLabel: "チャンネルの設定" -->
<p>サーバーの初期設定では，gmsv/channelがルートディレクトリに設定されています。
チャンネルの階層構造はファイルシステムを利用しています。
ルートディレクトリ以下にある定義されたファイルを置くとチャンネルとして認識されます。</p>
<h3><a name="label-5" id="label-5">ディレクトリ設定</a></h3><!-- RDLabel: "ディレクトリ設定" -->
<p>ディレクトリにも名前が定義されます。
これはクライアントからディレクトリの情報を要求された時に必要です。
ディレクトリの設定はチャンネルの設定とほぼ同じです。</p>
<h4><a name="label-6" id="label-6">チャンネル(ディレクトリ)設定ファイル</a></h4><!-- RDLabel: "チャンネル(ディレクトリ)設定ファイル" -->
<p>チャンネル(ディレクトリ)設定ファイルの書式です。ファイル名は自由に付けられます。
内容は1行1設定で</p>
<ul>
<li><p>url=STRING</p>
<pre>このチャンネルのurlを示す。ディレクトリの内容一覧をクライアントから要求された時に
この値が返る。
違うサーバーに接続する為のシンボリックリンクのように使用できる。
(省略可)</pre></li>
<li><p>name=STRING</p>
<pre>タイトル用の文字列</pre></li>
<li><p>writable=0 or 1</p>
<pre>書きこみ可能かどうか。ディレクトリの時のみ有効。
有効だとユーザーがこのディレクトリでチャンネルを作成することが出来る。</pre></li>
<li><p>attr=channel | dir</p>
<pre>チャンネルまたはディレクトリの設定であるかどうか。
どちらかを指定しないとこのファイルは有効にならない。</pre></li>
</ul>
<h2><a name="label-7" id="label-7">ルーム(部屋)空間</a></h2><!-- RDLabel: "ルーム(部屋)空間" -->
<pre>チャンネルにはルーム(部屋)が存在します。
部屋はゲームを始める為のユーザーを募集する空間です。
ユーザーは部屋に入室すると，その同じ部屋に存在する他ユーザーとゲームを始める事が出来ます。
現在は，部屋に入室しているユーザー全員を1つのゲームのメンバーとして扱います。
つまり，
部屋に入室する = あるゲームに参加の意思がある
という事になります。</pre>
<h2><a name="label-8" id="label-8">サーバープログラムのコンパイル</a></h2><!-- RDLabel: "サーバープログラムのコンパイル" -->
<p>サーバーのプログラムは，mm-suiteに完全に準ずるので，
mm-suiteのドキュメントを参考にしてください。</p>
<h2><a name="label-9" id="label-9">クライアントプログラムのコンパイル</a></h2><!-- RDLabel: "クライアントプログラムのコンパイル" -->
<h3><a name="label-10" id="label-10">コンパイルに必要なもの。</a></h3><!-- RDLabel: "コンパイルに必要なもの。" -->
<ul>
<li>Ruby インタプリタ <a href="http://www.ruby-lang.org/">&lt;URL:http://www.ruby-lang.org/&gt;</a> からダウンロード出来ます。</li>
<li>VCE (出来るだけ最新のもの)</li>
<li>SDLライブラリー(linuxのみ) <a href="http://www.devolution.com/~slouken/SDL/">&lt;URL:http://www.devolution.com/~slouken/SDL/&gt;</a> からダウンロード出来ます。</li>
</ul>
<p>lobbysuite/cliディレクトリで，</p>
<pre>% make</pre>
<p>とします。lobbysuiteディレクトリでmakeでもコンパイルできます。</p>
<p>linux版クライアントも作成できます。make linuxとすればlinux用クライアントが作成できます。</p>
<h2><a name="label-11" id="label-11">テストクライアントプログラムの使用方法</a></h2><!-- RDLabel: "テストクライアントプログラムの使用方法" -->
<p>テストクライアントは，メッセージウィンドウ，コマンドウィンドウ，入力ウィンドウを持っています。
コマンドウィンドウで行いたいコマンドを選択，場合によっては入力ウィンドウにて入力，
決定後コマンドがサーバーに送信され，結果が出力されます。</p>
<p>クライアントで行えるコマンドは現在は以下の通りです。</p>
<ul>
<li>Connect (サーバーに接続)</li>
<li>Disconect (サーバーから切断)</li>
<li>CrChan (チャンネルの作成)</li>
<li>DelChan (チャンネルの削除)</li>
<li>SvList (サーバーリスト取得)</li>
<li>Open (チャンネルのオープン)</li>
<li>List (キャラクターリストの取得)</li>
<li>Login (キャラクターログイン)</li>
<li>CrChar (キャラクター作成)</li>
<li>DelChar (キャラクター削除)</li>
<li>Ping (ping送信)</li>
<li>Message ( メッセージ送信)</li>
<li>Mail (メール送信)</li>
<li>PollMail (メール受信)</li>
<li>EnterRoom (部屋入室)</li>
<li>ListRoom (部屋一覧)</li>
<li>CrRoom ( 部屋の作成)</li>
<li>DelRoom (部屋の削除)</li>
<li>ExitRoom (退室)</li>
<li>GameStart (ゲーム開始)</li>
<li>GameEnd (ゲーム終了)</li>
<li>NewStatus (コンタクトリストのメンバーに状態送信)</li>
<li>LoadContact (コンタクトリストのロード)</li>
<li>SaveContact (コンタクトリストのセーブ)</li>
<li>UserId (サーバーに送信するユーザーID変更)</li>
<li>Password (サーバーに送信するパスワード変更)</li>
<li>Cdkey (サーバーに送信するCDKEY変更)</li>
</ul>
<p>各コマンドに対してどのような返答が返ってくるかは，
lobbysuite/proto/lobbyproto.txt
を参考にしてください。</p>
<h2><a name="label-12" id="label-12">文字入力システムH2N(仮名)について</a></h2><!-- RDLabel: "文字入力システムH2N(仮名)について" -->
<pre>テストクライアントの，文字入力方法として，H2Nというシステムを使用しています。
これは，文字入力を速く入力する為に考えだされたシステムで，
ユーザーフレンドリーな入力方法ではないですが，慣れれば速く入力することが出来ます。
詳しい操作方法は((&lt;URL|h2n.html&gt;))を参照してください。</pre>
<h2><a name="label-13" id="label-13">自動テストクライアント</a></h2><!-- RDLabel: "自動テストクライアント" -->
<p>ruby を使用して作成された自動テストクライアントがあります。
主にサーバーが正常に動作しているかを調べます。
ディレクトリは lobbysuite/tester/ です。</p>
<p>あらかじめ lobbysuite/lobbysv/ ディレクトリで，</p>
<pre>% ruby maketestchannel channel</pre>
<p>として，テスト用チャンネルを作成し，サーバーを起動しておきます。
そして，lobbysuite/tester/ ディレクトリで</p>
<pre>% make test</pre>
<p>とすれば，自動テストが開始されます。テストに失敗するとエラーメッセージが出力されます。</p>
<p>※テストに失敗した場合，まれにDBやchannelディレクトリにゴミ(データ)が残る場合があります。</p>
<pre>DBにデータが残ると，次回テスト時，失敗したりするので，データのクリアを忘れないようにしてください。
例えば全てのキャラクターデータを消す方法は，

% mysql -u root
mysql&gt; delete from charinfo;

とすれば消えます。しかし全てのデータが消えるので注意してください。</pre>
<pre>written by Masahiro Kawata(ｲﾏﾅﾄ ﾀｵｹｭ)
mas@vce-lab.net
CommunityEngine Inc.
2001</pre>

</body>
</html>
